<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
          <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
          <title>Payday Loan Tracker</title>
          <%= stylesheet_link_tag "reset", "style", "invalid", "south-street/jquery-ui-1.7.2.custom", "application", "form", :media => "screen" %>
          <!--[if lte IE 7]>
            <%= stylesheet_link_tag "ie", :media => "screen" %>
          <![endif]-->
		  <%= javascript_include_tag :defaults %>
		 

          <%= javascript_include_tag "jquery-1.3.2.min",
                                     "jquery.inplace",
                                     "simpla.jquery.configuration",
                                     "jquery.wysiwyg",
                                     "jquery.history",
                                     "jquery-ui-1.7.2.custom.min",
                                     "jquery.qtip-1.0.0-rc3.min",
                                     "jquery.iphone_switch",
                                     "jquery.periodicalupdater",
                                     "jquery.updater",
                                     "facebox",
                                     "application" %>
									 
          <!--[if IE 6]>
            <%= javascript_include_tag "DD_belatedPNG_0.0.7a" %>
                  <script type="text/javascript">
                          DD_belatedPNG.fix('.png_bg, img, li');
                  </script>
          <![endif]-->
          <%= yield :head %>
	</head>  
  <body>
  	 
    <% if logged_in? && ['underwriter','collections','garnishments'].include?(current_user.role) -%>
      <%#= auto_session_timeout_js :frequency => 15 %>
      <script type="text/javascript">
        $.PeriodicalUpdater('/active', {
          method: 'get',          // method; get or post
          data: '',               // array of values to be passed to the page - e.g. {name: "John", greeting: "hello"}
          minTimeout: 60000,       // starting value for the timeout in milliseconds
          maxTimeout: 60000,       // maximum length of time between requests
          multiplier: 1,          // if set to 2, timerInterval will double each time the response hasn't changed (up to
          type: 'text',           // response type - text, xml, json, etc.  See $.ajax config options
          maxCalls: 0,            // maximum number of calls. 0 = no limit.
          autoStop: 0             // automatically stop requests after this many returns of the same data. 0 = disabled.
        }, function(data) {
          // Handle the new data (only called when there was a change)
          if (data == 'false') window.location.href = '/logout';
         
        });
      </script>
    <% end -%>
    
    <div id="body-wrapper"> <!-- Wrapper for the radial gradient background -->

      <div id="sidebar"><div id="sidebar-wrapper"> <!-- Sidebar with logo and menu -->
              <%= link_to image_tag("logo.png", :alt => "Payday Loan Tracker", :id => "logo") %>

              <div id="profile-links">
                      Hello, <%= link_to current_user.full_name %> | <%= link_to "Sign Out", logout_path %><br/>
                      <% if (cnt = current_user.notifications.length) > 0 %>
                        You have <%= link_to pluralize(cnt, "message"), "#messages", :rel => "modal" %>
                      <% else %>
                        You have 0 messages
                      <% end %>
              </div>

              <div id="search_box">
                <% form_tag "/search" do %>
                  <input type="text" name="q" value="<%= h @q %>" />
                <% end %>
              </div>

              <ul id="main-nav">  <!-- Accordion Menu -->

                <li><%= link_to "Dashboard", root_path, :class => "nav-top-item no-submenu #{controller.controller_name == 'dashboard' ? 'current' : ''}" %></li>
                <li>
                  <%= link_to "Loans", "#", :class => "nav-top-item #{controller.controller_name == 'loans' ? 'current' : ''}" %>
                  <ul>
                    <% if ["underwriter"].include? current_user.role %>
                    <li>
                      <%= link_to "My Loans", my_loans_path,
                            :class => (((["my_loans"].include? controller.action_name) &&
                                        (["loans"].include? controller.controller_name)) ? "current" : "") %>
                    </li>
                    <% end %>
                    <li>
                      <%= link_to "Loan List", loans_path,
                        :class => (((["index"].include? controller.action_name) &&  (["loans"].include? controller.controller_name)) ? "current" : "") %>
                    </li>
                    <li>
                      <%= link_to "Add a new Customer", new_customer_path,
                                    :class => ((["new"].include? controller.action_name) ? "current" : "") %>
                    </li>
                  </ul>
                </li>
				<% if current_user.role == 'administrator' %> 
					  <li><%= link_to "Teams", "#", :class => "nav-top-item #{(["teams"].include? controller.controller_name) ? 'current' : ''}"  %>
					  	<ul>
					  		<li><%= link_to "Teams", teams_path,
                          		:class => ((["teams"].include? controller.controller_name) ? "current" : "") %></li>
						</ul>
					  </li>
				<%end%>
                <li><%= link_to "Transactions", root_path, :class => "nav-top-item" %></li>
                <li><%= link_to "Reports", root_path, :class => "nav-top-item" %></li>
				 <%if ["administrator"].include? current_user.role %>
                <li>
                  <%= link_to "Settings", "#",
                          :class => "nav-top-item #{(["lead_filters", "lead_providers", "users", "locations"].include? controller.controller_name) ? 'current' : ''}" %>
                    <ul>
                    
                      <li><%= link_to "Locations", locations_path,
                          :class => ((["locations"].include? controller.controller_name) ? "current" : "") %></li>
                      <li><%= link_to "High Risk Branches", high_risk_bank_branches_path,
                          :class => ((["high_risk_bank_branches"].include? controller.controller_name) ? "current" : "") %></li>
                      <li><%= link_to "User Accounts", users_path,
                                :class => ((["users"].include? controller.controller_name) ? "current" : "") %></li>
                      <li><%= link_to "Lead Submission Filters", lead_filters_path,
                                :class => ((["lead_filters"].include? controller.controller_name) ? "current" : "") %></li>
                      <li><%= link_to "Lead Providers", lead_providers_path,
                                :class => ((["lead_providers"].include? controller.controller_name) ? "current" : "") %></li>
                      <li><%= link_to "Mail Templates", mail_templates_path,
                                :class => ((["mail_templates"].include? controller.controller_name) ? "current" : "") %></li>
						
                    </ul>
                </li>
				<% elsif current_user.manager==true %>
				<li>
                  <%= link_to "Team", "#",:class => "nav-top-item #{(["users"].include? controller.controller_name) ? 'current' : ''}" %>
					<ul>
						<li><%= link_to "Team Availability", {:controller=>:users,:action=>:team_availability},
                                :class => ((["mail_templates"].include? controller.action_name) ? "team_availability" : "") %></li>
					</ul>
				</li>
				<%end%>
                <li><%= link_to "ACH", root_path, :class => "nav-top-item" %></li>
                <li><%= link_to "Help", root_path, :class => "nav-top-item" %></li>

              </ul> <!-- End #main-nav -->


              <div id="messages" style="display: none">

                <h3><%= pluralize(current_user.notifications.count, "Message") %></h3>
                <% current_user.notifications.each do |notification| %>
                <p id="message_<%= notification.id %>">
                        <strong><%= notification.created_at.strftime("%d %b %Y %I:%M %p") %></strong> by <%= notification.author_name %><br />
                        <%= h notification.short_message %>
                        &nbsp;&nbsp;
                        <% if notification.comment.commentable_type == "Customer" %>
                          <small><%= link_to "View", "/customers/#{notification.comment.commentable_id}#comments", :class => "remove-link green", :title => "View customer" %> |</small>
                  <% end %>
                        <small><%= link_to "Hide", "/mark_notification_as_read/#{notification.id}", :title => "Hide message", :class => "remove-link" %></small>
                </p>
                <% end %>
              </div>

      </div></div> <!-- End #sidebar -->

      <div id="main-content"> <!-- Main Content Section with everything -->

        <%- if show_title? -%>
          <h2><%=h yield(:title) %></h2>
        <%- end -%>
        <%- if show_subtitle? -%>
          <p id="page-intro"><%=h yield(:subtitle) %></p>
        <%- end -%>

        <%= yield %>

          <div id="footer">
            <small>
              &#169; Copyright <%= Time.now.year %> Payday Loan Tracker | Powered by <a href="http://themeforest.net/item/simpla-admin-flexible-user-friendly-admin-skin/46073">Simpla Admin</a> | <a href="#">Top</a>
            </small>
          </div><!-- End #footer -->

      </div> <!-- End #main-content -->

    </div>
    
  </body>
</html>
