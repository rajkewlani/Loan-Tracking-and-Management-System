<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>Payday Loan Tracker</title>
    <%= stylesheet_link_tag "reset", "style", "invalid", "south-street/jquery-ui-1.7.2.custom", "application", "form", :media => "screen" %>
    <!--[if lte IE 7]>
    <%= stylesheet_link_tag "ie", :media => "screen" %>
    <![endif]-->

<%= javascript_include_tag :defaults %>

    <%= javascript_include_tag  "jquery-1.3.2.min",
      "jquery.inplace",
      "simpla.jquery.configuration",
      "jquery.wysiwyg",
      "jquery.history",
      "jquery-ui-1.7.2.custom.min",
      "jquery.qtip-1.0.0-rc3.min",
      "jquery.iphone_switch",
#      "jquery-ui-1.8.custom.min.js",
      "jquery.periodicalupdater",
      "jquery.updater",
      "facebox",
      "application"
  %>

    <!--[if IE 6]>
    <%= javascript_include_tag "DD_belatedPNG_0.0.7a" %>
            <script type="text/javascript">
                    DD_belatedPNG.fix('.png_bg, img, li');
            </script>
    <![endif]-->
    <%= yield :head %>
  </head>
  <body>

    <% if logged_in? && ['underwriter','collections','garnishments'].include?(current_user.role) -%>
  <%#= auto_session_timeout_js :frequency => 15 %>
      <script type="text/javascript">
        $.PeriodicalUpdater('/active', {
          method: 'get',          // method; get or post
          data: '',               // array of values to be passed to the page - e.g. {name: "John", greeting: "hello"}
          minTimeout: 60000,       // starting value for the timeout in milliseconds
          maxTimeout: 60000,       // maximum length of time between requests
          multiplier: 1,          // if set to 2, timerInterval will double each time the response hasn't changed (up to
          type: 'text',           // response type - text, xml, json, etc.  See $.ajax config options
          maxCalls: 0,            // maximum number of calls. 0 = no limit.
          autoStop: 0             // automatically stop requests after this many returns of the same data. 0 = disabled.
        }, function(data) {
          // Handle the new data (only called when there was a change)
          if (data == 'false') window.location.href = '/logout';
         
        });
      </script>
    <% end -%>

    <div id="body-wrapper"> <!-- Wrapper for the radial gradient background -->

      <div id="sidebar"><div id="sidebar-wrapper"> <!-- Sidebar with logo and menu -->
          <%= link_to image_tag("logo.png", :alt => "Payday Loan Tracker", :id => "logo") %>

          <div id="profile-links">
            Hello, <%= link_to current_user.full_name %> | <%= link_to "Sign Out", logout_path %><br/>
            <% if (cnt = current_user.notifications.length) > 0 %>
              You have <%= link_to pluralize(cnt, "message"), "#messages", :rel => "modal" %>
            <% else %>
              You have 0 messages
            <% end %>
          </div>

          <div id="search_box">
            <% form_tag "/search" do %>
              <!--<input type="text" name="q" value="<%= h @q %>" />-->
            <% end %>
          </div>

          <%= render :partial => "shared/#{current_user.role}_menu" %>


          <div id="messages" style="display: none">

            <h3><%= pluralize(current_user.notifications.count, "Message") %></h3>
            <% current_user.notifications.each do |notification| %>
              <p id="message_<%= notification.id %>">
                <strong><%= notification.created_at.strftime("%d %b %Y %I:%M %p") %></strong> by <%= notification.author_name %><br />
                <%= h notification.short_message %>
                &nbsp;&nbsp;
                <% if notification.comment.commentable_type == "Customer" %>
                  <small><%= link_to "View", "/customers/#{notification.comment.commentable_id}#comments", :class => "remove-link green", :title => "View customer" %> |</small>
                <% end %>
                <small><%= link_to "Hide", "/mark_notification_as_read/#{notification.id}", :title => "Hide message", :class => "remove-link" %></small>
              </p>
            <% end %>
          </div>

        </div></div> <!-- End #sidebar -->

      <div id="main-content"> <!-- Main Content Section with everything -->

        <%- if show_title? -%>
          <h2><%=h yield(:title) %></h2>
        <%- end -%>
        <%- if show_subtitle? -%>
          <p id="page-intro"><%=h yield(:subtitle) %></p>
        <%- end -%>

        <%= yield %>

        <div id="footer">
          <small>
            &#169; Copyright <%= Time.now.year %> Payday Loan Tracker | Powered by <a href="http://themeforest.net/item/simpla-admin-flexible-user-friendly-admin-skin/46073">Simpla Admin</a> | <a href="#">Top</a>
          </small>
        </div><!-- End #footer -->

      </div> <!-- End #main-content -->

    </div>

  </body>
</html>
